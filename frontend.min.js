jQuery(document).ready(function(a){function b(b,d){a(".spinner").fadeIn(),a(d).find(".ezscm-message").fadeOut(),d||(d=".ezscm"),a(d).each(function(d,e){var f=a(e).find(".s_id").val(),g="action=get_public_schedule";g+="&id="+f,g+="&add="+a(e).data("add"),b&&(g+="&week="+b),a.ajax({type:"post",url:ezscm_ajaxurl,data:{action:"ezscm_frontend",data:g},success:function(d){return d?(1==ezscm_form_vars[f].debug_mode&&console.log(d),d=a.parseJSON(d),a(e).find(".ezscm-loading, .spinner").hide(),a(e).find(".ezscm-container, .ezscm-schedule-wrapper, .ezscm-browse").fadeIn(),d.options.length<1?(a(e).find(".ezscm-schedule-wrapper").text(ezscm_vars.noid),!1):(c(a(e),d.entries,d.options,b),void 0)):!1}})})}function c(b,c,d,e){moment.locale(d.lang_dates.value);var f=d.days_available.value.split(","),g=[];if(d.time_block){var h=d.time_block.value.split(","),i=[];for(var j in h)i.push(h[j].split("-"));g.push(i)}else g.push([d.time_block_start.value,d.time_block_end.value]);e=e?moment(e,"YYYY-MM-DD"):moment().startOf("isoWeek");var k,l;g.length>0&&(k=moment(g[0],"HH:mm"),l=moment(g[1],"HH:mm"));var n=a.parseJSON(d.closed_days.value),o="08:00".split(":"),p="16:00".split(":"),q="01:00".split(":"),r=parseInt(o[0]),s=parseInt(o[1]),t=parseInt(p[0]),u=parseInt(p[1]),v=parseInt(q[0]),w=parseInt(q[1]),x=60*(t-r),y=u-s,z=Math.floor((x+y)/(60*v+w)),A=moment(),B="<div class='ezscm-schedule'>",C="";C+="<ul class='schedule-day schedule-times schedule-times-main'>",C+="	<li class='schedule-header'></li>";for(var D=moment({hours:r,minute:s}),E=0;z>E;E++)C+="<li class='entry-small'>",C+="	<span>"+D.format(d.time_format.value)+"</span>",C+="</li>",D.add("hours",v).add("minutes",w);C+="</ul>",B+=C;for(var F=7*parseInt(d.show_weeks_amount_frontend.value),G=0;F>G;G++){var I,H=!1,J=G-7*Math.floor(G/7);if(G>=7){if(!f[J])continue;I=parseInt(f[J])+G-J,H=f[J]==f[0]}else{if(!f[G])continue;0==f[G]&&(f[G]=7),I=f[G]}H&&(B+="</div><div class='ezscm-schedule'>",B+=C);for(var K=moment(e).startOf("isoWeek").isoWeekday(I).hour(r).minute(s),L=moment(e,"YYYY-MM-DD").startOf("isoWeek").isoWeekday(I),M=L.format("YYYY-MM-DD"),N=L.format(d.date_format.value),O=moment(e,"YYYY-MM-DD").isoWeekday(I).format("dddd"),P=!1,Q=0;Q<n.length;Q++){var R=moment(n[Q].from,"YYYY-MM-DD"),S=moment(n[Q].to,"YYYY-MM-DD");(L.isAfter(R)&&L.isBefore(S)||L.isSame(R)||L.isSame(S))&&(P=!0)}B+="<div class='schedule-list-day'>";var D=moment({hours:r,minute:s});B+="<ul class='schedule-day schedule-times schedule-times-responsive'>",B+="	<li class='schedule-header'></li>";for(var E=0;z>E;E++)B+="<li class='entry-small'>",B+="	<span>"+D.format(d.time_format.value)+"</span>",B+="</li>",D.add("hours",v).add("minutes",w);B+="</ul>",B+="<ul class='schedule-times'>",B+="	<li class='schedule-header'>"+O+"<br>"+N+"</li>";for(var T=0;z>T;T++){var U,V=K.format("HH:mm:ss");if(P)U="entry-blocked";else{U="entry-free";var W=L.hour(K.hour()).minute(K.minute()),X=moment().add("hours",d.entry_time_ahead.value);(W.isBefore(A)||W.isBefore(X))&&(U="entry-blocked");for(var Y=0;Y<g.length;Y++){var k=moment(M+" "+g[Y][0]),l=moment(M+" "+g[Y][1]);if((K.isAfter(k)||K.isSame(k))&&K.isBefore(l)){U="entry-blocked";break}}1==d.display_only.value&&(U+=" nosubmit")}B+="<li class='schedule-entry "+U+"' data-date='"+M+"' data-time='"+V+"' data-dateformat='"+N+"' data-s_id='"+d.days_available.s_id+"'>",B+="	<span></span>",B+="</li>",K.add("hours",v).add("minutes",w)}B+="</ul>",B+="</div>"}a(b).find(".ezscm-schedule-wrapper").html(B);for(var Z=0;Z<c.length;Z++){var $=c[Z].date,_=c[Z].time_begin,ab=".schedule-entry[data-date='"+$+"'][data-time='"+_+"']";a(b).find(ab).removeClass("entry-free").addClass("entry-public"),c[Z].hasOwnProperty("data")&&a(b).find(ab+" span").text(c[Z].data)}var bb=moment(e).subtract("days",F).format("YYYY-MM-DD"),cb=moment(e).add("days",F).format("YYYY-MM-DD");a(b).find(".ezscm-browse-prev").data("browseweek",bb),a(b).find(".ezscm-browse-next").data("browseweek",cb),moment(bb).isBefore(moment().startOf("isoWeek"))?a(b).find(".ezscm-browse-prev").fadeOut():a(b).find(".ezscm-browse-prev").fadeIn()}a.fx.speeds._default=150,b(),a(".spinner-wrapper").show(),a("body").on("click",".schedule-entry.entry-free:not(.nosubmit)",function(){var b=a(this).parents(".ezscm")[0],c=a(b).data("id"),d=ezscm_form_vars[c];a(".entry-selected").removeClass("entry-selected"),a(this).addClass("entry-selected"),a(b).find(".ezscm-message").fadeOut(),a(b).find(".s_id").val(a(this).data("s_id")),a(b).find(".date_internal").val(a(this).data("date")),a(b).find(".time_internal").val(a(this).data("time"));var e=moment(a(this).data("date"),"YYYY-MM-DD").format(d.date_format),f=moment(a(this).data("time"),"HH:mm:ss").format(d.time_format);a(b).find(".callbackdate").val(e),a(b).find(".callbackhour").val(f),a(b).find(".ezscm-details").fadeIn(),a.scrollTo(a(b).find(".ezscm-details"),800,{offset:-200})}),a("[data-action='get_schedule']").click(function(){var c="#"+a(this).parents(".ezscm").attr("id"),d=a(this).data("browseweek");a(c).find(".ezscm-schedule-wrapper, .ezscm-details").fadeOut(),b(d,c)}),a(".ezscm-form").on("submit",function(b){a(this).find(".ezscm-loading").show(),a(this).find("input[type='submit']").attr("disabled","disabled");var c=a(this).find(".s_id").val(),d="action=submit&id="+c+"&"+a(this).serialize(),e=a(".entry-selected"),f=a(this).parents(".ezscm");return a.ajax({type:"post",url:ezscm_ajaxurl,data:{action:"ezscm_frontend",data:d},success:function(b){return a(f).find(".ezscm-loading").hide(),a(f).find("input[type='submit']").removeAttr("disabled"),a(f).find(".ezscm-message").fadeIn(),b?(1==ezscm_form_vars[c].debug_mode&&console.log(b),b=a.parseJSON(b),b.error?(a(f).find(".ezscm-message").html("<p class='text-danger'>"+b.error+"</p>"),"undefined"!=typeof Recaptcha&&Recaptcha.reload(),!1):("undefined"!=typeof Recaptcha&&Recaptcha.reload(),b.success&&(a(e).removeClass("entry-free").addClass("entry-public"),a(f).find(".ezscm-message").text(b.success),a(f).find(".ezscm-details").fadeOut(),ezscm_form_vars[c]&&ezscm_form_vars[c].redirect_url&&ezscm_form_vars[c].redirect_url.length>0&&window.location.replace(ezscm_form_vars[c].redirect_url)),void 0)):(a(f).find(".ezscm-message").text("Something went wrong. :("),!1)}}),b.preventDefault(),!1})});